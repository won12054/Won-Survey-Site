<div class="registration-container">
  <h2>Register</h2>
  <form [formGroup]="registrationForm" (ngSubmit)="register()" novalidate>
    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" formControlName="email">
      <div *ngIf="registrationForm.get('email')?.touched || registrationForm.get('email')?.dirty">
        <div *ngIf="registrationForm.get('email')?.hasError('required')" class="error">
          Email is required.
        </div>
        <div *ngIf="registrationForm.get('email')?.hasError('email')" class="error">
          Invalid email format.
        </div>
        <div *ngIf="registrationForm.get('email')?.hasError('emailTaken')" class="error">
          Email is already in use.
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="password">Password</label>
      <input type="password" id="password" formControlName="password">
      <div *ngIf="registrationForm.get('password').touched">
        <div *ngIf="registrationForm.get('password').hasError('required')" class="error">
          Password is required.
        </div>
        <div *ngIf="registrationForm.get('password').hasError('minlength')" class="error">
          Minimum 8 characters.
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="confirm_password">Confirm Password</label>
      <input type="password" id="confirm_password" formControlName="confirm_password">
      <div *ngIf="registrationForm.get('confirm_password').touched">
        <div *ngIf="registrationForm.get('confirm_password').hasError('required')" class="error">
          This field is required.
        </div>
        <div *ngIf="registrationForm.get('confirm_password').hasError('mismatch')" class="error">
          Passwords do not match.
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="username">Username</label>
      <input type="text" id="username" formControlName="username">
      <div *ngIf="registrationForm.get('username').errors && (registrationForm.get('username').dirty || registrationForm.get('username').touched)">
        <div *ngIf="registrationForm.get('username').hasError('required')" class="error">Username is required.</div>
        <div *ngIf="registrationForm.get('username').hasError('usernameTaken')" class="error">Username is already taken.</div>
      </div>
    </div>

    <div class="form-group">
      <label for="birth_date">Birth Date</label>
      <input type="date" id="birth_date" formControlName="birth_date" [max]="today">
      <div *ngIf="registrationForm.get('birth_date').touched">

        <div *ngIf="registrationForm.get('birth_date').hasError('required')" class="error">
          Birth date is required.
        </div>
        <div *ngIf="registrationForm.get('birth_date').hasError('futureDate')" class="error">
          No future date.
        </div>
        <div *ngIf="registrationForm.get('birth_date').hasError('tooEarly')" class="error">
          Must be after 01/01/1900.
        </div>
        <div *ngIf="registrationForm.get('birth_date').hasError('invalidDate')" class="error">
          Enter a valid date.
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="country">Country</label>
      <select id="country" formControlName="country">
        <option *ngFor="let country of countryOptions" [value]="country">{{ country }}</option>
      </select>
      <div *ngIf="registrationForm.get('country').touched && registrationForm.get('country').errors">
        <div *ngIf="registrationForm.get('country').hasError('required')" class="error">
          Country is required.
        </div>
      </div>
    </div>

    <div class="form-group">
      <label>Gender</label>
      <select id="gender" formControlName="gender">
        <option *ngFor="let gender of genderOptions" [value]="gender">{{ gender }}</option>
      </select>
    </div>

    <div class="form-group">
      <label for="education_level">Education Level</label>
      <select id="education_level" formControlName="education_level">
        <option *ngFor="let level of educationLevels" [value]="level">{{level}}</option>
      </select>
    </div>

    <div class="form-group">
      <label for="ethnicity">Ethnicity</label>
      <select id="ethnicity" formControlName="ethnicity">
        <option *ngFor="let ethnicity of ethnicities" [value]="ethnicity">{{ethnicity}}</option>
      </select>
    </div>

    <div class="form-group">
      <label for="subscription_type">Subscription Type</label>
      <select id="subscription_type" formControlName="subscription_type">
        <option *ngFor="let type of subscriptionTypes" [value]="type">{{type}}</option>
      </select>
    </div>

    <button type="submit">Register</button>
    <div *ngIf="submitted && !registrationForm.valid" class="error">
      Failed to register!
    </div>
  </form>
</div>
